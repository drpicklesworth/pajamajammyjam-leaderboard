<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pajama Jammy Jam - Leaderboard</title>
<link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    background: linear-gradient(135deg,#0f0c29 0%,#302b63 50%,#24243e 100%);
    min-height:100vh;
    font-family:'Courier New', monospace;
    padding:40px 20px;
    overflow-x:hidden;
    color:#d4af37;
}
.header { position:fixed; top:0; left:0; right:0; padding:40px 20px 20px;
    background: linear-gradient(135deg,#0f0c29 0%,#302b63 50%,#24243e 100%);
    z-index:100; text-align:center;
}
.main-title { font-size:60px; font-family:'Great Vibes', cursive; text-shadow:3px 3px 6px rgba(0,0,0,0.7);}
.subtitle { font-size:20px; opacity:0.8; letter-spacing:3px; text-transform:uppercase; margin-top:5px;}

.content-wrapper { 
    margin-top:200px; 
    display:flex; 
    gap:40px;
    justify-content:center;
    align-items:flex-start;
    min-height:calc(100vh - 250px);
}

@media (max-width: 1200px) {
    .content-wrapper {
        flex-direction: column;
        align-items: center;
    }
}

.main-content {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: flex-end;
}

.leaderboard-container { 
    display:flex; 
    justify-content:center; 
    align-items:flex-end; 
    gap:30px; 
    flex-wrap:wrap; 
    max-width:100%; 
    transition: all 0.8s ease; 
}
.participant-card { 
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    transition: all 0.8s ease; 
    position:relative; 
}

/* ORIGINAL FRAME STYLE */
.frame {
    width: 180px;
    height: 220px;
    background: linear-gradient(145deg, #e6c04f 0%, #c4a747 100%);
    padding: 12px;
    border-radius: 8px;
    box-shadow: 
        0 10px 30px rgba(0,0,0,0.5),
        inset 0 2px 6px rgba(255,255,255,0.4);
    position: relative;
    border: 4px solid #8b6914;
}

.frame::before {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    background: 
        radial-gradient(circle at 0 0, transparent 8px, #8b6914 8px, #8b6914 12px, transparent 12px),
        radial-gradient(circle at 100% 0, transparent 8px, #8b6914 8px, #8b6914 12px, transparent 12px),
        radial-gradient(circle at 0 100%, transparent 8px, #8b6914 8px, #8b6914 12px, transparent 12px),
        radial-gradient(circle at 100% 100%, transparent 8px, #8b6914 8px, #8b6914 12px, transparent 12px);
    background-size: 50% 50%;
    background-repeat: no-repeat;
    background-position: top left, top right, bottom left, bottom right;
    pointer-events: none;
    border-radius: 8px;
}

.photo-container {
    width: 100%;
    height: 100%;
    background: #2a2a2a;
    border-radius: 2px;
    overflow: hidden;
    position: relative;
}

.photo {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.name-tag { 
    margin-top:15px; 
    background:rgba(212,175,55,0.2); 
    padding:8px 20px; 
    border-radius:20px; 
    border:2px solid #d4af37; 
    font-weight:bold; 
    text-shadow:1px 1px 2px rgba(0,0,0,0.5); 
    text-align:center; 
}
.score { 
    margin-top:10px; 
    font-size:32px; 
    color:#fff; 
    font-weight:bold; 
    text-shadow:2px 2px 4px rgba(0,0,0,0.7); 
}

/* Party Participants Sidebar */
.sidebar {
    width: 280px;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(212, 175, 55, 0.3);
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    flex-shrink: 0;
}

.sidebar-title {
    font-size: 18px;
    color: #d4af37;
    text-align: center;
    margin-bottom: 15px;
    letter-spacing: 2px;
    text-transform: uppercase;
    opacity: 0.9;
}

.party-list {
    display: flex;
    flex-direction: column;
    gap: 5px;
    max-height: 500px;
    overflow-y: auto;
}

.party-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    padding: 8px 10px;
    background: rgba(212, 196, 160, 0.08);
    border-radius: 5px;
    transition: background 0.2s ease;
}

.party-item:hover {
    background: rgba(212, 196, 160, 0.15);
}

.party-name {
    color: #d4af37;
    font-size: 14px;
    flex-grow: 1;
}

.party-completed {
    color: #d4af37;
    font-size: 14px;
    font-weight: bold;
}

.party-list::-webkit-scrollbar {
    width: 6px;
}

.party-list::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.2);
    border-radius: 3px;
}

.party-list::-webkit-scrollbar-thumb {
    background: rgba(212, 175, 55, 0.3);
    border-radius: 3px;
}

.party-list::-webkit-scrollbar-thumb:hover {
    background: rgba(212, 175, 55, 0.5);
}

.loading { 
    text-align:center; 
    font-size:20px; 
    margin-top:50px; 
}
.loading .dots::after { 
    content:'.'; 
    animation: dots 1.5s steps(3,end) infinite; 
}
@keyframes dots { 
    0% { content:'.'; } 
    33% { content:'..'; } 
    66% { content:'...'; } 
    100% { content:''; } 
}

.update-indicator { 
    position: fixed; 
    top: 20px; 
    right: 20px; 
    color: #4a9b4a; 
    font-size:14px; 
    opacity:0; 
    transition:opacity 0.3s ease; 
}
.update-indicator.show { 
    opacity:1; 
}

.version { 
    position:fixed; 
    bottom:10px; 
    right:10px; 
    font-size:11px; 
    opacity:0.5; 
}
</style>
</head>
<body>
<div class="header">
    <div class="main-title">Pajama Jammy Jam</div>
    <div class="subtitle">Current Scores</div>
</div>
<div class="update-indicator" id="updateIndicator">‚óè Live</div>
<div class="version" id="version">v2.4</div>

<div class="content-wrapper">
    <div class="main-content">
        <div id="content">
            <div class="loading">Preparing the slumber party<span class="dots"></span></div>
        </div>
    </div>
    
    <div class="sidebar" id="sidebar" style="display:none;">
        <div class="sidebar-title">Party Progress</div>
        <div class="party-list" id="partyList">
            <div class="loading">Loading<span class="dots"></span></div>
        </div>
    </div>
</div>

<script>
const SHEET_JSON_URL = 'https://script.google.com/macros/s/AKfycbxuzg6fbzzHHVvGvITQ5iYLae_FQraJjLFjfqrTBKfGdoCYcnBq5-KYAG34cWNLj1ldgA/exec';
const fallbackImage = 'https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/User-avatar.svg/240px-User-avatar.svg.png';
let participants = [];
let partyGuests = [];

const loadingTexts = [
    "Fluffing the pillows",
    "Mixing the cocoa",
    "Counting pajama stripes",
    "Tossing confetti",
    "Aligning the stuffed animals"
];

function getRandomLoadingText() {
    return loadingTexts[Math.floor(Math.random() * loadingTexts.length)];
}

async function loadData() {
    const content = document.getElementById('content');
    const hasExistingContent = content.querySelector('.leaderboard-container');
    
    // Only show loading message if page is empty
    if (!hasExistingContent) {
        content.innerHTML = `<div class="loading">${getRandomLoadingText()}<span class="dots"></span></div>`;
    }

    try {
        const res = await fetch(SHEET_JSON_URL);
        const data = await res.json();
        
        console.log('üìä Data received:', data); // Debug log
        
        // Handle both new format {contestants: [], partyGuests: []} and old format [...]
        if (data.contestants) {
            participants = data.contestants.sort((a,b)=>b.score - a.score);
            partyGuests = data.partyGuests ? data.partyGuests.sort((a,b)=>b.completed - a.completed) : [];
        } else {
            // Old format - just contestant array
            participants = data.sort((a,b)=>b.score - a.score);
            partyGuests = [];
        }
        
        console.log('üë• Contestants:', participants.length);
        console.log('üéâ Party guests:', partyGuests.length);
        
        renderLeaderboard();
        renderPartyList();
        showUpdateIndicator();
    } catch(err) {
        console.error('‚ùå Error loading data:', err);
        content.innerHTML = `<div class="error">Error loading leaderboard. Check Apps Script deployment and sheet permissions.</div>`;
    }
}

function renderLeaderboard() {
    const container = document.getElementById('content');
    container.innerHTML = '<div class="leaderboard-container"></div>';
    const board = container.querySelector('.leaderboard-container');

    participants.forEach((p,i)=>{
        const card = document.createElement('div');
        card.className = 'participant-card';
        card.style.order = i;

        card.innerHTML = `
            <div class="frame">
                <div class="photo-container">
                    <img src="${p.photo || fallbackImage}" alt="${p.name}" class="photo" onerror="this.src='${fallbackImage}'">
                </div>
            </div>
            <div class="name-tag">${p.name}</div>
            <div class="score">${p.TimeToSimpson}</div>
        `;
        board.appendChild(card);
    });
}

function renderPartyList() {
    const sidebar = document.getElementById('sidebar');
    const listContainer = document.getElementById('partyList');
    
    if (partyGuests.length === 0) {
        sidebar.style.display = 'none';
        return;
    }
    
    sidebar.style.display = 'block';
    listContainer.innerHTML = '';
    
    partyGuests.forEach(guest => {
        const item = document.createElement('div');
        item.className = 'party-item';
        item.innerHTML = `
            <div class="party-name">${guest.name}</div>
            <div class="party-completed">${guest.completed}</div>
        `;
        listContainer.appendChild(item);
    });
}

function showUpdateIndicator() {
    const indicator = document.getElementById('updateIndicator');
    indicator.classList.add('show');
    setTimeout(()=>indicator.classList.remove('show'),2000);
}

loadData();
setInterval(loadData, 30000);
</script>
</body>
</html>
